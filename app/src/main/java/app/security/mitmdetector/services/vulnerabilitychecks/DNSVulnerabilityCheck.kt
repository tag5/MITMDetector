package app.security.mitmdetector.services.vulnerabilitychecks

import javax.inject.Singleton
import javax.inject.Inject
import android.util.Log
import app.security.mitmdetector.data.AuditResult
import java.net.InetAddress

@Singleton
class DNSVulnerabilityCheck @Inject constructor(): VulnerabilityCheckBase() {
    override fun getCheckId(): String {
        return "dns"
    }

    override fun run(): AuditResult {
        try {
            val inetAddress = InetAddress.getByName("dns.google.com")
            if (inetAddress.hostAddress == "8.8.8.8" || inetAddress.hostAddress == "8.8.4.4") {
                Log.i("DNSVulnerabilityCheck", "DNSVulnerabilityCheck: check OK")
                return AuditResult.NoAlert
            }

            Log.i("DNSVulnerabilityCheck", "DNSVulnerabilityCheck: Wrong google DNS")
            return AuditResult.VulnerabilityDetected("Wrong google DNS")
        } catch (e: Exception) {
            Log.e("DNSVulnerabilityCheck", "DNSVulnerabilityCheck: " + e.toString())
            return AuditResult.Error(e.toString())
        }
    }
}